<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOHF-E-HAYAT: Blood & Organ Donor Services</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        .hero-bg {
            background-image: linear-gradient(to right, rgba(239, 68, 68, 0.8), rgba(236, 72, 153, 0.8)), url('https://placehold.co/1200x600/d1d5db/374151?text=Hospital+Background');
            background-size: cover;
            background-position: center;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ef4444;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-red-500">TOHF-E-HAYAT</a>
            <div class="hidden md:flex space-x-6 items-center">
                <a href="#home" class="nav-link text-gray-600 hover:text-red-500 transition duration-300">Home</a>
                <a href="#about" class="nav-link text-gray-600 hover:text-red-500 transition duration-300">About Us</a>
                <a href="#find" class="nav-link text-gray-600 hover:text-red-500 transition duration-300">Find a Donor</a>
                <a href="#register" class="nav-link bg-red-500 text-white px-4 py-2 rounded-full hover:bg-red-600 transition duration-300">Register as Donor</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-gray-600 focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>
        <div id="mobile-menu" class="md:hidden hidden px-6 pb-4 space-y-2">
            <a href="#home" class="nav-link block text-gray-600 hover:text-red-500">Home</a>
            <a href="#about" class="nav-link block text-gray-600 hover:text-red-500">About Us</a>
            <a href="#find" class="nav-link block text-gray-600 hover:text-red-500">Find a Donor</a>
            <a href="#register" class="nav-link block bg-red-500 text-white px-4 py-2 rounded-full text-center">Register as Donor</a>
        </div>
    </header>

    <main>
        <!-- Home Section -->
        <section id="home" class="section active">
            <div class="hero-bg text-white py-24 md:py-32">
                <div class="container mx-auto px-6 text-center">
                    <h1 class="text-4xl md:text-6xl font-bold mb-4">Give the Gift of Life</h1>
                    <p class="text-lg md:text-xl mb-8 max-w-2xl mx-auto">Become a donor and be a hero to someone in need. Your contribution can save lives and bring hope to families.</p>
                    <a href="#register" class="nav-link bg-white text-red-500 px-8 py-3 rounded-full font-semibold text-lg hover:bg-gray-200 transition duration-300">Register to Donate</a>
                </div>
            </div>
            <div class="py-16 bg-white">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-3xl font-bold mb-8">Why Your Donation Matters</h2>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="p-6 rounded-lg">
                            <h3 class="text-xl font-semibold mb-2 text-red-500">Save Lives</h3>
                            <p>A single organ donor can save up to eight lives, and a blood donation can help multiple patients.</p>
                        </div>
                        <div class="p-6 rounded-lg">
                            <h3 class="text-xl font-semibold mb-2 text-red-500">Community Impact</h3>
                            <p>Strengthen your community by ensuring a ready supply of blood and organs for emergencies.</p>
                        </div>
                        <div class="p-6 rounded-lg">
                            <h3 class="text-xl font-semibold mb-2 text-red-500">A Noble Act</h3>
                            <p>Donation is a selfless act of kindness that offers a second chance at life to someone in critical need.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Us Section -->
        <section id="about" class="section py-16">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center mb-10">About TOHF-E-HAYAT</h2>
                <div class="flex flex-col md:flex-row items-center gap-12">
                    <div class="md:w-1/2">
                        <img src="https://placehold.co/600x400/ef4444/ffffff?text=Our+Team" alt="Our Mission" class="rounded-lg shadow-lg" onerror="this.onerror=null;this.src='https://placehold.co/600x400/ef4444/ffffff?text=Image+Not+Found'">
                    </div>
                    <div class="md:w-1/2">
                        <h3 class="text-2xl font-semibold mb-4 text-red-500">Our Mission</h3>
                        <p class="mb-4">Our mission at TOHF-E-HAYAT is to create a seamless and efficient platform that connects voluntary blood and organ donors with those in urgent need. We believe that technology can bridge the gap in healthcare logistics, making it easier to save lives.</p>
                        <p>We are dedicated to raising awareness about the importance of donation and building a strong, reliable network of heroes across the nation.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Find a Donor Section -->
        <section id="find" class="section py-16">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center mb-10">Find a Donor</h2>
                
                <!-- Search and Filter UI -->
                <div class="bg-white p-6 rounded-lg shadow-md mb-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
                    <div>
                        <label for="search-city" class="block text-sm font-medium text-gray-700">City</label>
                        <input type="text" id="search-city" placeholder="e.g., Karachi" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500">
                    </div>
                    <div>
                        <label for="search-donation-type" class="block text-sm font-medium text-gray-700">Looking For</label>
                        <select id="search-donation-type" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500">
                            <option value="all">All Donors</option>
                            <option value="blood">Blood Donors</option>
                            <option value="organ">Organ Donors</option>
                        </select>
                    </div>
                    <div id="blood-type-filter-container">
                        <label for="search-blood-type" class="block text-sm font-medium text-gray-700">Blood Type</label>
                        <select id="search-blood-type" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500">
                            <option value="">Any</option>
                            <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                            <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
                        </select>
                    </div>
                    <div id="organ-filter-container" class="hidden">
                        <label for="search-organ" class="block text-sm font-medium text-gray-700">Organ</label>
                        <select id="search-organ" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500">
                             <option value="">Any</option>
                            <option>Kidney</option><option>Liver</option><option>Heart</option>
                            <option>Lungs</option><option>Pancreas</option><option>Cornea</option>
                        </select>
                    </div>
                </div>

                <!-- Donor List -->
                <div id="loader" class="mx-auto my-8"></div>
                <div id="no-results" class="text-center py-10 text-gray-500 hidden">
                    <p class="text-lg">No donors found matching your criteria.</p>
                </div>
                <div id="donor-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Donor cards will be inserted here by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Register Section -->
        <section id="register" class="section py-16">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center mb-10">Become a Lifesaver</h2>
                <div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-md">
                    <form id="registration-form">
                        <!-- Personal Information -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label for="fullName" class="block text-sm font-medium text-gray-700">Full Name</label>
                                <input type="text" id="fullName" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required>
                            </div>
                            <div>
                                <label for="age" class="block text-sm font-medium text-gray-700">Age</label>
                                <input type="number" id="age" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required min="18" max="65">
                            </div>
                             <div>
                                <label for="gender" class="block text-sm font-medium text-gray-700">Gender</label>
                                <select id="gender" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required>
                                    <option value="">Select Gender</option>
                                    <option>Male</option>
                                    <option>Female</option>
                                    <option>Other</option>
                                </select>
                            </div>
                            <div>
                                <label for="phone" class="block text-sm font-medium text-gray-700">Phone Number</label>
                                <input type="tel" id="phone" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required>
                            </div>
                             <div>
                                <label for="city" class="block text-sm font-medium text-gray-700">City</label>
                                <input type="text" id="city" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required>
                            </div>
                            <div>
                                <label for="state" class="block text-sm font-medium text-gray-700">State / Province</label>
                                <input type="text" id="state" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required>
                            </div>
                        </div>

                        <!-- Donation Type -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">What would you like to donate?</label>
                            <div class="flex items-center space-x-4">
                               <label><input type="checkbox" id="donate-blood" class="rounded"> Blood</label>
                               <label><input type="checkbox" id="donate-organ" class="rounded"> Organs</label>
                            </div>
                        </div>

                        <!-- Blood Donation Details -->
                        <div id="blood-donation-details" class="hidden mb-6">
                             <label for="blood-type" class="block text-sm font-medium text-gray-700">Blood Type</label>
                            <select id="blood-type" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                <option value="">Select Blood Type</option>
                                <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                                <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
                            </select>
                        </div>
                        
                        <!-- Organ Donation Details -->
                        <div id="organ-donation-details" class="hidden mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Which organs would you like to pledge?</label>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                                <label class="flex items-center"><input type="checkbox" value="Kidney" name="organ" class="mr-2 rounded">Kidney</label>
                                <label class="flex items-center"><input type="checkbox" value="Liver" name="organ" class="mr-2 rounded">Liver</label>
                                <label class="flex items-center"><input type="checkbox" value="Heart" name="organ" class="mr-2 rounded">Heart</label>
                                <label class="flex items-center"><input type="checkbox" value="Lungs" name="organ" class="mr-2 rounded">Lungs</label>
                                <label class="flex items-center"><input type="checkbox" value="Pancreas" name="organ" class="mr-2 rounded">Pancreas</label>
                                <label class="flex items-center"><input type="checkbox" value="Cornea" name="organ" class="mr-2 rounded">Cornea</label>
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-red-500 text-white py-3 rounded-lg font-semibold hover:bg-red-600 transition duration-300">Register Now</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 TOHF-E-HAYAT. All Rights Reserved.</p>
        </div>
    </footer>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-lg transition-opacity duration-300 opacity-0">
        <p id="toast-message"></p>
    </div>

    <!-- JAVASCRIPT SECTION -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Global Variables ---
            // This is the address of your local Node.js server
            const SERVER_URL = 'http://localhost:3000';
            let allDonors = [];

            // --- Element Selectors ---
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.nav-link');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            
            // Registration Form Elements
            const registrationForm = document.getElementById('registration-form');
            const donateBloodCheckbox = document.getElementById('donate-blood');
            const donateOrganCheckbox = document.getElementById('donate-organ');
            const bloodDetails = document.getElementById('blood-donation-details');
            const organDetails = document.getElementById('organ-donation-details');

            // Find Donor Page Elements
            const donorList = document.getElementById('donor-list');
            const loader = document.getElementById('loader');
            const noResults = document.getElementById('no-results');
            const searchCity = document.getElementById('search-city');
            const searchDonationType = document.getElementById('search-donation-type');
            const bloodTypeFilterContainer = document.getElementById('blood-type-filter-container');
            const organFilterContainer = document.getElementById('organ-filter-container');
            const searchBloodType = document.getElementById('search-blood-type');
            const searchOrgan = document.getElementById('search-organ');
            
            // --- SPA Navigation Logic ---
            const showSection = (hash) => {
                const id = hash ? hash.substring(1) : 'home';
                sections.forEach(section => {
                    if (section.id === id) {
                        section.classList.add('active');
                    } else {
                        section.classList.remove('active');
                    }
                });
                // If navigating to 'find', fetch donors
                if (id === 'find') {
                    fetchDonors();
                }
            };

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    const hash = link.getAttribute('href');
                    if(hash.startsWith('#')) {
                        e.preventDefault();
                        window.location.hash = hash;
                        mobileMenu.classList.add('hidden');
                    }
                });
            });

            window.addEventListener('hashchange', () => showSection(window.location.hash));
            showSection(window.location.hash || '#home'); // Show initial section
            
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });


            // --- Registration Form Logic ---
            donateBloodCheckbox.addEventListener('change', () => {
                bloodDetails.classList.toggle('hidden', !donateBloodCheckbox.checked);
            });
            donateOrganCheckbox.addEventListener('change', () => {
                organDetails.classList.toggle('hidden', !donateOrganCheckbox.checked);
            });

            registrationForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const isBloodDonor = donateBloodCheckbox.checked;
                const isOrganDonor = donateOrganCheckbox.checked;

                if (!isBloodDonor && !isOrganDonor) {
                    showToast('Please select at least one donation type (Blood or Organs).', true);
                    return;
                }

                const pledgedOrgans = isOrganDonor ? 
                    [...document.querySelectorAll('input[name="organ"]:checked')].map(cb => cb.value) : [];

                if (isOrganDonor && pledgedOrgans.length === 0) {
                    showToast('Please select at least one organ to pledge.', true);
                    return;
                }
                
                const bloodType = document.getElementById('blood-type').value;
                if(isBloodDonor && !bloodType) {
                    showToast('Please select your blood type.', true);
                    return;
                }

                const donorData = {
                    fullName: document.getElementById('fullName').value,
                    age: parseInt(document.getElementById('age').value),
                    gender: document.getElementById('gender').value,
                    phone: document.getElementById('phone').value,
                    city: document.getElementById('city').value,
                    state: document.getElementById('state').value,
                    isBloodDonor,
                    bloodType: isBloodDonor ? bloodType : null,
                    isOrganDonor,
                    organs: isOrganDonor ? pledgedOrgans : [],
                };
                
                try {
                    // Send data to the Node.js server
                    const response = await fetch(`${SERVER_URL}/api/donors`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(donorData),
                    });

                    const result = await response.json();

                    if (!response.ok) {
                        throw new Error(result.error || 'Failed to register.');
                    }

                    showToast('Registration successful! Thank you for being a hero.');
                    registrationForm.reset();
                    bloodDetails.classList.add('hidden');
                    organDetails.classList.add('hidden');
                    window.location.hash = '#find';

                } catch (error) {
                    console.error('Registration Error:', error);
                    showToast(`Registration failed: ${error.message}`, true);
                }
            });

            // --- Find Donor Logic ---
            
            // Function to fetch donors from the backend server
            async function fetchDonors() {
                loader.style.display = 'block';
                noResults.classList.add('hidden');
                donorList.innerHTML = '';
                try {
                    const response = await fetch(`${SERVER_URL}/api/donors`);
                    if (!response.ok) {
                        throw new Error('Could not fetch data from the server.');
                    }
                    const result = await response.json();
                    allDonors = result.data;
                    filterDonors();
                } catch (error) {
                    console.error("Error fetching donors:", error);
                    showToast('Could not fetch donor data.', true);
                } finally {
                    loader.style.display = 'none';
                }
            }

            // Function to render donor cards on the page
            function renderDonors(donorsToRender) {
                donorList.innerHTML = '';
                if (donorsToRender.length === 0) {
                    noResults.classList.remove('hidden');
                    return;
                }
                noResults.classList.add('hidden');

                donorsToRender.forEach(donor => {
                    // Organs are stored as a JSON string, so we need to parse them
                    const organs = (donor.isOrganDonor && donor.organs) ? JSON.parse(donor.organs) : [];

                    const card = document.createElement('div');
                    card.className = 'bg-white p-6 rounded-lg shadow-md border-l-4 border-red-500';
                    card.innerHTML = `
                        <h3 class="text-xl font-bold mb-2">${donor.fullName}</h3>
                        <p class="text-gray-600 mb-4">${donor.city}, ${donor.state}</p>
                        <div class="space-y-2">
                            <div class="flex items-center">
                                <span class="text-red-500 font-semibold mr-2">Phone:</span>
                                <a href="tel:${donor.phone}" class="text-blue-600 hover:underline">${donor.phone}</a>
                            </div>
                            ${donor.isBloodDonor ? `
                            <div class="flex items-center">
                                <span class="text-red-500 font-semibold mr-2">Blood Type:</span>
                                <span>${donor.bloodType}</span>
                            </div>` : ''}
                            ${donor.isOrganDonor && organs.length > 0 ? `
                            <div class="flex items-start">
                                <span class="text-red-500 font-semibold mr-2 shrink-0">Pledged Organs:</span>
                                <span>${organs.join(', ')}</span>
                            </div>` : ''}
                        </div>
                    `;
                    donorList.appendChild(card);
                });
            }

            // Function to filter donors based on search criteria
            function filterDonors() {
                const type = searchDonationType.value;
                const city = searchCity.value.trim().toLowerCase();
                const bloodType = searchBloodType.value;
                const organ = searchOrgan.value;

                const filtered = allDonors.filter(donor => {
                    const cityMatch = !city || (donor.city && donor.city.toLowerCase().includes(city));
                    
                    let typeMatch = true;
                    if (type === 'blood') typeMatch = donor.isBloodDonor;
                    if (type === 'organ') typeMatch = donor.isOrganDonor;

                    const bloodMatch = !bloodType || (donor.isBloodDonor && donor.bloodType === bloodType);
                    
                    // Parse organs string before checking
                    const organsArray = (donor.isOrganDonor && donor.organs) ? JSON.parse(donor.organs) : [];
                    const organMatch = !organ || (donor.isOrganDonor && organsArray.includes(organ));

                    return cityMatch && typeMatch && bloodMatch && organMatch;
                });
                renderDonors(filtered);
            }
            
            // Event Listeners for Filters
            searchDonationType.addEventListener('change', () => {
                const type = searchDonationType.value;
                bloodTypeFilterContainer.style.display = (type === 'all' || type === 'blood') ? 'block' : 'none';
                organFilterContainer.style.display = (type === 'all' || type === 'organ') ? 'block' : 'none';
                if (type === 'blood') organFilterContainer.style.display = 'none';
                if (type === 'organ') bloodTypeFilterContainer.style.display = 'none';
                filterDonors();
            });

            searchCity.addEventListener('input', filterDonors);
            searchBloodType.addEventListener('change', filterDonors);
            searchOrgan.addEventListener('change', filterDonors);

            // --- Utility Functions ---
            function showToast(message, isError = false) {
                const toast = document.getElementById('toast');
                const toastMessage = document.getElementById('toast-message');
                toastMessage.textContent = message;
                toast.className = `fixed bottom-5 right-5 text-white px-6 py-3 rounded-lg shadow-lg transition-opacity duration-300 opacity-100 ${isError ? 'bg-red-600' : 'bg-gray-900'}`;
                setTimeout(() => {
                    toast.style.opacity = '0';
                }, 3000);
            }
        });
    </script>
</body>
</html>


